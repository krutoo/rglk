!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=new WeakMap,o=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i.set(this,{}),this.x=e,this.y=n}return r(t,[{key:"getDistanceTo",value:function(t){return t=t||{},Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}},{key:"isEqualTo",value:function(t){return(t=t||{}).x===this.x&&t.y===this.y}},{key:"x",get:function(){return Number(i.get(this).x)||0},set:function(t){isNaN(t)||(i.get(this).x=Number(t))}},{key:"y",get:function(){return Number(i.get(this).y)||0},set:function(t){isNaN(t)||(i.get(this).y=Number(t))}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=new WeakMap,o=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),isNaN(e)&&!isFinite(e))throw new TypeError("PRNG.constructor: first argument must be a finite number");i.set(this,Number(e))}return r(t,[{key:"generate",value:function(t,e){var n=(9301*i.get(this)+49297)%233280,r=n/233280;return i.set(this,n),r}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(0),u=(r=o)&&r.__esModule?r:{default:r};var a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t=t||{};var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.x,t.y));return n.g=t.g,n.h=t.h,n.parent=t.parent,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,u.default),i(e,[{key:"getPathToRoot",value:function(){for(var t=[],e=this;e.parent;)t.push(e),e=e.parent;return t.reverse()}},{key:"g",get:function(){return Number(this._g)||0},set:function(t){isNaN(t)||(this._g=Number(t))}},{key:"h",get:function(){return Number(this._h)||0},set:function(t){isNaN(t)||(this._h=Number(t))}},{key:"parent",get:function(){return this._parent instanceof e?this._parent:null},set:function(t){t instanceof e&&(this._parent=t)}},{key:"f",get:function(){return this.g+this.h}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(2),u=(r=o)&&r.__esModule?r:{default:r};var a=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof Function))throw new TypeError("Pathfinder.constructor: first argument must be a function");this._isOpen=e}return i(t,[{key:"search",value:function(t,e,n,r){for(var i=this,o=new u.default({x:t,y:e}),a=new u.default({x:n,y:r}),f=[o],s=[],c=[],l=function(){var t=0,e=f[0];if(f.forEach(function(n,r){n.f<e.f&&(e=n,t=r)}),f.splice(t,1),s.push(e),e.isEqualTo(a))return c=e.getPathToRoot(),"break";for(var n=i.getNeighbors(e),r=function(t){var e=n[t];if(s.find(function(t){return t.isEqualTo(e)}))return"continue";f.find(function(t){return t.isEqualTo(e)})||(e.h=i.getHeuristic(e.x,e.y,a.x,a.y),f.push(e))},o=0;o<n.length;o++)r(o)};f.length;){if("break"===l())break}return c}},{key:"getHeuristic",value:function(t,e,n,r){return Math.abs(n-t)+Math.abs(r-e)}},{key:"getNeighbors",value:function(t){for(var e=[],n=-1;n<=1;n++)for(var r=-1;r<=1;r++)1===Math.abs(r+n)&&this._isOpen(t.x+r,t.y+n)&&e.push(new u.default({x:t.x+r,y:t.y+n,g:t.g+1,parent:t}));return e}}]),t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(0),u=(r=o)&&r.__esModule?r:{default:r};var a=new WeakMap,f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e instanceof Function&&(a.set(this,{isTransparent:e}),this._isTransparent=e)}return i(t,[{key:"calculate",value:function(t,e,n,r){var i={};if(this.checkArguments.apply(this,arguments))for(var o=Math.pow(n,2),f=new u.default(t,e),s=f.x-n,c=f.x+n,l=f.y-n,h=f.y+n,y=r instanceof Function,p=a.get(this).isTransparent,d=l;d<=h;d++)for(var g=s;g<=c;g++)if(s===g||c===g||l===d||h===d){var v=this.getPointsOfLine(f,new u.default(g,d));t:for(var b=0;b<v.length;b++){var m=v[b],w=Math.pow(f.x-m.x,2)+Math.pow(f.y-m.y,2),k=p(m.x,m.y);if(!(w<=o&&k))break t;y&&r(m.x,m.y),i[m.x+"x"+m.y]=m}}return Object.values(i)}},{key:"checkArguments",value:function(t,e,n,r){return!isNaN(t+e+n)&&isFinite(t+e+n)}},{key:"getPointsOfLine",value:function(t,e){for(var n=e.x-t.x,r=e.y-t.y,i=Math.abs(n),o=Math.abs(r),a=n>0?1:-1,f=r>0?1:-1,s=new u.default(t.x,t.y),c=[new u.default(s.x,s.y)],l=0,h=0;l<i||h<o;)(.5+l)/i==(.5+h)/o?(s.x+=a,s.y+=f,l++,h++):(.5+l)/i<(.5+h)/o?(s.x+=a,l++):(s.y+=f,h++),c.push(new u.default(s.x,s.y));return c}}]),t}();e.default=f},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(0),u=(r=o)&&r.__esModule?r:{default:r};var a=new WeakMap,f=function(t){function e(t,n,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a.set(o,{}),o.width=r,o.height=i,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,u.default),i(e,[{key:"collides",value:function(t){t=t||{};var e=!0;return(this.left>t.right||this.right<t.left||this.top>t.bottom||this.bottom<t.top)&&(e=!1),e}},{key:"width",get:function(){return Number(a.get(this).width)||0},set:function(t){isNaN(t)||(a.get(this).width=Number(t))}},{key:"height",get:function(){return Number(a.get(this).height)||0},set:function(t){isNaN(t)||(a.get(this).height=Number(t))}},{key:"left",get:function(){return this.x},set:function(t){this.x=t}},{key:"bottom",get:function(){return this.y+this.height},set:function(t){this.y=t-this.height}},{key:"right",get:function(){return this.x+this.width},set:function(t){this.x=t-this.width}},{key:"top",get:function(){return this.y},set:function(t){this.y=t}},{key:"center",get:function(){return new u.default(this.x+this.width/2,this.y+this.height/2)}}]),e}();e.default=f},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=f(n(1)),u=f(n(0)),a=f(n(5));function f(t){return t&&t.__esModule?t:{default:t}}function s(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var c=Object.freeze({room:1,corridor:2,connector:3}),l=Object.freeze({left:0,bottom:1,right:2,top:3}),h=new WeakMap,y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),h.set(this,{}),this.setOptions(e),this.generate()}return i(t,[{key:"setOptions",value:function(t){h.get(this).options=this.validateOptions(t,this.getDefaultOptions())}},{key:"validateOptions",value:function(t,e){var n=this;t=t||{};var r={};return Object.keys(e).forEach(function(i){var o=t[i],u=e[i],a=n.getMininalOptions()[i];isNaN(o)||!isFinite(o)||o<a?r[i]=u:r[i]=parseInt(o,10)}),r}},{key:"getMininalOptions",value:function(){return{seed:-1/0,roomsAmount:1,roomMinSize:1,roomMaxSize:1,corridorMinLength:1,corridorMaxLength:1,corridorComplexity:1}}},{key:"getDefaultOptions",value:function(){return{seed:Math.random(),roomsAmount:7,roomMinSize:5,roomMaxSize:10,corridorMinLength:3,corridorMaxLength:7,corridorComplexity:2}}},{key:"forEachTile",value:function(t){if(t instanceof Function)for(var e=0;e<this.height;e++)for(var n=0;n<this.width;n++)t(e,n,this.isFloor(e,n));return this}},{key:"isWall",value:function(t,e){return!this.isFloor(t,e)}},{key:"isFloor",value:function(t,e){var n=!1,r=h.get(this).buffer||[];return t<=this.width&&e<=this.height&&(n=Boolean(r[this.getBufferIndex(t,e,this.height)])),n}},{key:"generate",value:function(){var t=this.getOptions();return h.get(this).prng=new o.default(t.seed),h.get(this).builds=this.optimizeBuilds(this.generateBuilds(t)),h.get(this).buffer=this.createBuffer(this.builds),this}},{key:"generateBuilds",value:function(t){for(var e=[this.createRoom({x:0,y:0})];e.filter(function(t){return t.type===c.room}).length<this.getOptions().roomsAmount;)e.push.apply(e,s(this.tryBuild(e,t)));return e}},{key:"tryBuild",value:function(t,e){var n=this,r=t.filter(function(t){return t.type!==c.corridor}),i=r[this.getRandom(0,r.length-1)],o=this.createBranch(i,e.corridorComplexity);return o.some(function(e){return!n.isSuitableBuild(e,t.concat(o))})&&(i.children.pop(),o=[]),o}},{key:"createBranch",value:function(t,e){for(var n=[],r=t,i=0;i<e;i++){var o=this.createCorridor({parent:r}),u=null;u=i<e-1?this.createConnector({parent:o}):this.createRoom({parent:o}),n.push(o,u),r=u}return n}},{key:"createConnector",value:function(t){var e=t.parent,n=this.createRoom({parent:e,width:1,height:1});return n.type=c.connector,n}},{key:"createRoom",value:function(t){var e=t.x,n=t.y,r=t.width,i=t.height,o=t.parent,u=this.getOptions(),a=u.roomMinSize,f=u.roomMaxSize,s=this.createBuild(c.room,{parent:o,x:e,y:n,width:r||this.getRandom(a,f),height:i||this.getRandom(a,f)});if(o){o.direction;this.placeBuild(s,o)}return s}},{key:"createCorridor",value:function(t){t.x,t.y,t.width,t.height;var e=t.parent,n=this.getOptions(),r=n.corridorMinLength,i=n.corridorMaxLength,o=this.createBuild(c.corridor,{parent:e,width:1,height:1}),u=this.getRandom(r,i);return e&&(o.direction===l.left||o.direction===l.right?o.width=u:o.height=u,this.placeBuild(o,e)),o}},{key:"placeBuild",value:function(t,e){var n=t.type===c.corridor?t.direction||0:e.direction||0;switch(n===l.left||n===l.right?t.y=this.getRandom(e.top-t.height+1,e.bottom-1):t.x=this.getRandom(e.left-t.width+1,e.right-1),n){case l.left:t.x=e.right;break;case l.bottom:t.y=e.bottom;break;case l.right:t.x=e.left-t.width;break;case l.top:t.y=e.top-t.height}}},{key:"getOptions",value:function(){return r({},this.getDefaultOptions(),h.get(this).options)}},{key:"createBuild",value:function(t,e){var n=e.x,r=e.y,i=e.width,o=e.height,u=e.parent,f=new a.default(n,r,i,o);return f.type=t,f.children=[],u&&(f.parent=u,u.children.push(f),f.direction=u.direction),t===c.corridor&&(f.direction=this.getRandom(0,3)),f}},{key:"getRandom",value:function(t,e){var n=h.get(this).prng.generate();return Math.floor(t+n*(e+1-t))}},{key:"isSuitableBuild",value:function(t,e){return!e.filter(function(e){var n=e===t,r=e===t.parent,i=t.children.includes(e),o=e.children.includes(t.parent)||t.children.includes(e.parent);return!(n||r||i||o)}).some(function(e){return e.collides(t)})}},{key:"optimizeBuilds",value:function(t){var e=this.getTopLeftPoint(t);return e.x<1&&this.translateBuilds(t,1-e.x,0),e.y<1&&this.translateBuilds(t,0,1-e.y),t}},{key:"getTopLeftPoint",value:function(t){var e=new u.default(1/0,1/0);return t.forEach(function(t){t.x<e.x&&(e.x=t.x),t.y<e.y&&(e.y=t.y)}),e}},{key:"translateBuilds",value:function(t,e,n){return t.forEach(function(t){t.x+=e,t.y+=n})}},{key:"createBuffer",value:function(t){var e=this,n=this.getBottomRightPoint(t);h.get(this).width=n.x+1,h.get(this).height=n.y+1;var r=Array(this.width*this.height);return r.fill(!1),t.forEach(function(t){return e.fillRectangle(r,e.height,t)}),r}},{key:"getBottomRightPoint",value:function(t){var e=new u.default(-1/0,-1/0);return t.forEach(function(t){t.right>e.x&&(e.x=t.right),t.bottom>e.y&&(e.y=t.bottom)}),e}},{key:"fillRectangle",value:function(t,e,n){for(var r=n.left,i=n.bottom,o=n.right,u=n.top;u<i;u++)for(var a=r;a<o;a++)t[this.getBufferIndex(a,u)]=!0}},{key:"getBufferIndex",value:function(t,e){return t*this.height+e}},{key:"width",get:function(){return parseInt(h.get(this).width,10)||0}},{key:"height",get:function(){return parseInt(h.get(this).height,10)||0}},{key:"rooms",get:function(){return this.builds.filter(function(t){return t.type===c.room})}},{key:"corridors",get:function(){return this.builds.filter(function(t){return t.type===c.corridor})}},{key:"connectors",get:function(){return this.builds.filter(function(t){return t.type===c.connector})}},{key:"builds",get:function(){var t=h.get(this).builds||[];return[].concat(s(t))}}]),t}();e.default=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Pathfinder=e.Explorer=e.Dungeon=e.PRNG=void 0;var r=a(n(1)),i=a(n(6)),o=a(n(4)),u=a(n(3));function a(t){return t&&t.__esModule?t:{default:t}}var f=Object.freeze({PRNG:r.default,Dungeon:i.default,Explorer:o.default,Pathfinder:u.default});e.default=f,e.PRNG=r.default,e.Dungeon=i.default,e.Explorer=o.default,e.Pathfinder=u.default}]);
//# sourceMappingURL=rglk.js.map