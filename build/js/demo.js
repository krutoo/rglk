!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=n}return r(t,[{key:"distanceTo",value:function(t){return t=t||{},Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}},{key:"isEqualTo",value:function(t){return(t=t||{}).x===this.x&&t.y===this.y}},{key:"x",get:function(){return Number(this._x)||0},set:function(t){isNaN(t)||(this._x=Number(t))}},{key:"y",get:function(){return Number(this._y)||0},set:function(t){isNaN(t)||(this._y=Number(t))}}]),t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.seed=e}return r(t,[{key:"generate",value:function(t,e){return e=isNaN(e)?1:Number(e),(t=isNaN(t)?0:Number(t))+this._updateSeed()/233280*(e-t)}},{key:"_updateSeed",value:function(){return this._seed=(9301*this._seed+49297)%233280}},{key:"seed",get:function(){return this._seed},set:function(t){this._seed=isNaN(t)||!isFinite(t)?Math.random():Number(t)}}]),t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(0),u=(r=o)&&r.__esModule?r:{default:r};var a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t=t||{};var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.x,t.y));return n.g=t.g,n.h=t.h,n.parent=t.parent,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,u.default),i(e,[{key:"getPathToRoot",value:function(){for(var t=[],e=this;e.parent;)t.push(e),e=e.parent;return t.reverse()}},{key:"g",get:function(){return Number(this._g)||0},set:function(t){isNaN(t)||(this._g=Number(t))}},{key:"h",get:function(){return Number(this._h)||0},set:function(t){isNaN(t)||(this._h=Number(t))}},{key:"parent",get:function(){return this._parent instanceof e?this._parent:null},set:function(t){t instanceof e&&(this._parent=t)}},{key:"f",get:function(){return this.g+this.h}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(2),u=(r=o)&&r.__esModule?r:{default:r};var a=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof Function))throw new TypeError("Pathfinder.constructor: first argument must be a function");this._isOpen=e}return i(t,[{key:"search",value:function(t,e,n,r){for(var i=this,o=new u.default({x:t,y:e}),a=new u.default({x:n,y:r}),s=[o],l=[],f=[],c=function(){var t=0,e=s[0];if(s.forEach(function(n,r){n.f<e.f&&(e=n,t=r)}),s.splice(t,1),l.push(e),e.isEqualTo(a))return f=e.getPathToRoot(),"break";for(var n=i._getNeighbors(e),r=function(t){var e=n[t];if(l.find(function(t){return t.isEqualTo(e)}))return"continue";s.find(function(t){return t.isEqualTo(e)})||(e.h=i._getHeuristic(e.x,e.y,a.x,a.y),s.push(e))},o=0;o<n.length;o++)r(o)};s.length;){if("break"===c())break}return f}},{key:"_getHeuristic",value:function(t,e,n,r){return Math.abs(n-t)+Math.abs(r-e)}},{key:"_getNeighbors",value:function(t){for(var e=[],n=-1;n<=1;n++)for(var r=-1;r<=1;r++)1===Math.abs(r+n)&&this._isOpen(t.x+r,t.y+n)&&e.push(new u.default({x:t.x+r,y:t.y+n,g:t.g+1,parent:t}));return e}}]),t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(0),u=(r=o)&&r.__esModule?r:{default:r};var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e instanceof Function&&(this._isTransparent=e)}return i(t,[{key:"calculate",value:function(t,e,n,r){var i={};if(this._checkArguments.apply(this,arguments))for(var o=Math.pow(n,2),a=new u.default(t,e),s=a.x-n,l=a.x+n,f=a.y-n,c=a.y+n,h=r instanceof Function,d=f;d<=c;d++)for(var y=s;y<=l;y++)if([s,l].includes(y)||[f,c].includes(d)){var p=this.getPointsOfLine(a,new u.default(y,d));t:for(var g=0;g<p.length;g++){var v=p[g];if(!(Math.pow(a.x-v.x,2)+Math.pow(a.y-v.y,2)<=o&&this._isTransparent(v.x,v.y)))break t;h&&r(v.x,v.y),i[v.x+"x"+v.y]=v}}return Object.values(i)}},{key:"_checkArguments",value:function(t,e,n,r){return!isNaN(t+e+n)&&isFinite(t+e+n)}},{key:"getPointsOfLine",value:function(t,e){for(var n=e.x-t.x,r=e.y-t.y,i=Math.abs(n),o=Math.abs(r),a=n>0?1:-1,s=r>0?1:-1,l=new u.default(t.x,t.y),f=[new u.default(l.x,l.y)],c=0,h=0;c<i||h<o;)(.5+c)/i==(.5+h)/o?(l.x+=a,l.y+=s,c++,h++):(.5+c)/i<(.5+h)/o?(l.x+=a,c++):(l.y+=s,h++),f.push(new u.default(l.x,l.y));return f}}]),t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(0),u=(r=o)&&r.__esModule?r:{default:r};var a=function(t){function e(t,n,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return o.width=r,o.height=i,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,u.default),i(e,[{key:"collides",value:function(t){t=t||{};var e=!1;return!isNaN(t.x+t.y+t.width+t.height)&&t.x<=this.x+this.width&&t.x+t.width>=this.x&&t.y<=this.y+this.height&&t.height+t.y>=this.y&&(e=!0),e}},{key:"forEachPoint",value:function(t){}},{key:"width",get:function(){return Number(this._width)||0},set:function(t){isNaN(t)||(this._width=Number(t))}},{key:"height",get:function(){return Number(this._height)||0},set:function(t){isNaN(t)||(this._height=Number(t))}},{key:"top",get:function(){return this.y}},{key:"right",get:function(){return this.x+this.width}},{key:"bottom",get:function(){return this.y+this.height}},{key:"left",get:function(){return this.x}},{key:"center",get:function(){return new u.default(this.x+this.width/2,this.y+this.height/2)}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=a(n(1)),o=a(n(0)),u=a(n(5));function a(t){return t&&t.__esModule?t:{default:t}}var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._tiles=[],this._rooms=[],this._corridors=[],this._prng=new i.default(e.seed),this._options=this.validateOptions(e),this.generate()}return r(t,[{key:"validateOptions",value:function(t){var e=this;t=t||{};var n={};return Object.keys(this.defaultOptions).forEach(function(r){var i=t[r];isNaN(i)||!isFinite(i)||i<1?n[r]=parseInt(e.defaultOptions[r],10)||1:n[r]=parseInt(i,10)}),n}},{key:"forEachTile",value:function(t){if(this._tiles&&t instanceof Function)for(var e=0;e<this._tiles.length;e++)for(var n=0;n<this._tiles[e].length;n++)t(n,e,this._tiles[e][n]);return this}},{key:"isFloor",value:function(){return!this.isWall.apply(this,arguments)}},{key:"isWall",value:function(t,e){var n=!0;return Array.isArray(this._tiles[e])&&this._tiles[e].hasOwnProperty(t)&&(n=!this._tiles[e][t]),n}},{key:"generate",value:function(){this._generateBuilds(),this._optimizeBuilds(),this._createMap()}},{key:"_generateBuilds",value:function(){var t=this,e=function(e,n){return Math.floor(t._prng.generate(n,e))},n=this._options,r=n.roomsAmount,i=n.roomMinSize,o=n.roomMaxSize,a=n.corridorMinLength,s=n.corridorMaxLength;this._rooms=[],this._corridors=[],this._rooms.push(new u.default(1,1,e(i,o),e(i,o))),this._rooms[0].children=[];for(var l=function(){var n=t._rooms[e(0,t._rooms.length-1)],r=e(i,o),l=e(i,o),f=new u.default(0,0,r,l),c=e(a,s),h=new u.default(0,0,1,1),d=parseInt(4*Math.random(),10);n.children.push(h),f.parent=h,f.children=[],h.parent=n,h.children=[f],0===d||2===d?(f.y=n.bottom-1-e(0,Math.abs(f.height+n.height)-1),h.y=e(Math.max(n.top,f.top),Math.min(n.bottom,f.bottom)-1),h.width=c):(f.x=n.right-1-e(0,Math.abs(f.width+n.width)-1),h.height=c,h.x=e(Math.max(n.left,f.left),Math.min(n.right,f.right))),0===d?(f.x=n.right+c,h.x=n.right):1===d?(f.y=n.bottom+c,h.y=n.bottom):2===d?(f.x=n.left-c-f.width,h.x=n.left-h.width):(f.y=n.top-c-f.height,h.y=n.top-h.height),t._isSuitableBuilds(f,h)?(t._rooms.push(f),t._corridors.push(h)):(n.children=n.children.filter(function(t){return t!==h}),h.children=h.children.filter(function(t){return t!==f}))};this._rooms.length<r;)l()}},{key:"_isSuitableBuilds",value:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.every(function(e){return t._isSuitableBuild(e)})}},{key:"_isSuitableBuild",value:function(t){return!this.builds.filter(function(e){return e.parent!==t.parent&&e!==t.parent&&e!==t.children&&!e.children.includes(t.parent)}).some(function(e){return e.collides(t)})}},{key:"_optimizeBuilds",value:function(){var t=this._getTopLeft();t.x<1&&this._translateBuilds(1-t.x,0),t.y<1&&this._translateBuilds(0,1-t.y)}},{key:"_getTopLeft",value:function(){var t=new o.default(1/0,1/0);return this.builds.forEach(function(e){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y)}),t}},{key:"_getBottomRight",value:function(){var t=new o.default(-1/0,-1/0);return this.builds.forEach(function(e){e.right>t.x&&(t.x=e.right),e.bottom>t.y&&(t.y=e.bottom)}),t}},{key:"_translateBuilds",value:function(t,e){this.builds.forEach(function(n){n.x+=t,n.y+=e})}},{key:"_createMap",value:function(){var t=this,e=this._getBottomRight();this._fillMap(e.x+2,e.y+2),this.builds.forEach(function(e){t._fillRectangle(e.x,e.y,e.width,e.height)})}},{key:"_fillMap",value:function(t,e){this._tiles=[];for(var n=0;n<e;n++){this._tiles.push([]);for(var r=0;r<t;r++)this._tiles[n].push(!1)}}},{key:"_fillRectangle",value:function(t,e,n,r){for(var i=e;i<=e+r-1;i++)for(var o=t;o<=t+n-1;o++)this._tiles[i][o]=!0}},{key:"defaultOptions",get:function(){return{seed:Math.random(),roomsAmount:7,roomMinSize:5,roomMaxSize:10,corridorMinLength:3,corridorMaxLength:7,corridorComplexity:3}}},{key:"rooms",get:function(){return this._rooms.slice()}},{key:"corridors",get:function(){return this._corridors.slice()}},{key:"builds",get:function(){return this.rooms.concat(this.corridors)}},{key:"width",get:function(){return Array.isArray(this._tiles[0])?this._tiles[0].length:0}},{key:"height",get:function(){return Array.isArray(this._tiles)?this._tiles.length:0}}]),t}();e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Pathfinder=e.Explorer=e.Dungeon=e.PRNG=void 0;var r=a(n(1)),i=a(n(6)),o=a(n(4)),u=a(n(3));function a(t){return t&&t.__esModule?t:{default:t}}var s={PRNG:r.default,Dungeon:i.default,Explorer:o.default,Pathfinder:u.default};Object.freeze(s),e.default=s,e.PRNG=r.default,e.Dungeon=i.default,e.Explorer=o.default,e.Pathfinder=u.default},function(t,e,n){"use strict";var r,i=n(7),o=(r=i)&&r.__esModule?r:{default:r};a(".js-section-dungeon",function(t){s(t,{dungeon:new o.default.Dungeon({roomsAmount:24,roomMinSize:3,roomMaxSize:10,corridorMinLength:1,corridorMaxLength:10*Math.random(),seed:Math.random()}),roomColor:"#445",corridorColor:"#223",needRoomsNumbers:!0})}),a(".js-section-labyrinth",function(t){s(t,{dungeon:new o.default.Dungeon({roomsAmount:128,roomMinSize:1,roomMaxSize:1,corridorMinLength:1,corridorMaxLength:1,seed:Math.random()}),roomColor:"#445",corridorColor:"#445"})});var u={x:0,y:0};function a(t,e){var n=document.querySelector(t);if(n){var r=n.querySelector("canvas"),i=n.querySelector(".js-reload-button");r&&(r.width=r.clientWidth,r.height=r.width/4*3,e(r)),i&&i.addEventListener("click",function(){return e(r)})}}function s(t,e){e=e||{};var n=t.getContext("2d"),r=e,i=r.fov,o=r.path,u=r.dungeon;e.tileSize=l(u,t),n.clearRect(0,0,t.width,t.height),u&&(function(t,e){var n=e=e||{},r=n.dungeon,i=n.roomColor,o=void 0===i?"#445":i,u=n.corridorColor,a=void 0===u?"#223":u,s=n.tileSize;r.rooms.forEach(function(n,r){t.fillStyle=o,t.fillRect(n.x*s,n.y*s,n.width*s,n.height*s),e.needRoomsNumbers&&(t.fillStyle="rgba(255,255,255,.5)",t.textBaseline="middle",t.textAlign="center",t.font=s+"px Arial",t.fillText(r,n.center.x*s,n.center.y*s))}),r.corridors.forEach(function(e){t.fillStyle=a,t.fillRect(e.x*s,e.y*s,e.width*s,e.height*s)})}(n,e),i&&function(t,e){var n=e.fov,r=e.center,i=e.radius,o=(e.dungeon,e.tileSize);n.forEach(function(e){var n=Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)),u=1-n/i;t.fillStyle="rgba(255,210,150,"+u+")",t.globalAlpha=.7,t.fillRect(e.x*o,e.y*o,o,o),t.globalAlpha=1})}(n,e),o&&function(t,e){var n=e.path,r=(e.dungeon,e.tileSize);t.strokeStyle="#0e0",t.fillStyle="#0e0",t.lineWidth=Math.ceil(r/3),n.length&&(t.beginPath(),t.moveTo(n[0].x*r+r/2,n[0].y*r+r/2),n.forEach(function(e,i){0!==i&&i!==n.length-1||t.fillRect(e.x*r,e.y*r,r,r),t.lineTo(e.x*r+r/2,e.y*r+r/2)}),t.stroke(),t.closePath())}(n,e))}function l(t,e){var n=Math.min(e.width,e.height),r=Math.max(t.width,t.height);return Math.floor(n/r)||8}a(".js-section-explorer",function(t){var e=new o.default.Dungeon({roomsAmount:6,roomMinSize:3,roomMaxSize:12,corridorMinLength:1,corridorMaxLength:1,seed:Math.random()}),n=new o.default.Explorer(function(t,n){return e.isFloor(t,n)}),r=l(e,t),i=n.calculate(parseInt(e.rooms[0].center.x,10),parseInt(e.rooms[0].center.y,10),12);t.onmousemove=function(i){u=function(t){var e={x:0,y:0};if(t instanceof Event){var n=t.target.getBoundingClientRect();e.x=t.clientX-n.left,e.y=t.clientY-n.top}return e}(i);var o={x:Math.round(u.x/r),y:Math.round(u.y/r)},a=n.calculate(o.x,o.y,12);e.isFloor(o.x,o.y)&&s(t,{fov:a,dungeon:e,radius:12,roomColor:"#222",corridorColor:"#222",center:o})},s(t,{fov:i,dungeon:e,radius:12,roomColor:"#222",corridorColor:"#222",center:e.rooms[0].center})}),a(".js-section-pathfinder",function(t){var e=new o.default.Dungeon({roomsAmount:24,roomMinSize:4,roomMaxSize:12,corridorMinLength:1,corridorMaxLength:5,seed:Math.random()});s(t,{path:new o.default.Pathfinder(function(t,n){return e.isFloor(t,n)}).search(parseInt(e.rooms[0].center.x,10),parseInt(e.rooms[0].center.y,10),parseInt(e.rooms[e.rooms.length-1].center.x,10),parseInt(e.rooms[e.rooms.length-1].center.y,10)),dungeon:e})})},function(t,e,n){n(8),t.exports=n(14)},,,,,function(t,e){}]);
//# sourceMappingURL=demo.js.map