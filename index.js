(()=>{"use strict";(()=>{var t=function(){function t(r,e){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=r,this.y=e}var r=t.prototype;return r.getDistanceTo=function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))},r.clone=function(){return new t(this.x,this.y)},t.isEqual=function(t,r){return t&&r&&t.x===r.x&&t.y===r.y},t}();function r(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}var e=function(){function t(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r(this,t),this.width=e,this.height=n,this.buffer=Array(e*n).fill(o)}var e=t.prototype;return e.get=function(r,e){return this.buffer[t.pointToIndex(r,e,this.width)]},e.set=function(r,e,n){this.buffer[t.pointToIndex(r,e,this.width)]=n},e.forEach=function(t){this.forEachInRect(0,0,this.width,this.height,t)},e.forEachInRect=function(t,r,e,n,o){for(var i=t;i<t+e;i++)for(var c=r;c<r+n;c++)o(i,c,this.get(i,c))},t.pointToIndex=function(t,r,e){return t+r*e},t}();function n(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,r){return!r||"object"!==u(r)&&"function"!=typeof r?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function c(t,r){return(c=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}var u=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};var a=function(r){!function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&c(t,r)}(l,r);var e,u,a,f,s=(a=l,f=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=o(a);if(f){var e=o(this).constructor;t=Reflect.construct(r,arguments,e)}else t=r.apply(this,arguments);return i(this,t)});function l(t,r,e,n){var o;return function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,l),(o=s.call(this,t,r)).width=e,o.height=n,o}return l.prototype.collides=function(t){var r=!0;return(this.left>t.right||this.right<t.left||this.top>t.bottom||this.bottom<t.top)&&(r=!1),r},e=l,(u=[{key:"left",get:function(){return this.x},set:function(t){this.x=t}},{key:"bottom",get:function(){return this.y+this.height},set:function(t){this.y=t-this.height}},{key:"right",get:function(){return this.x+this.width},set:function(t){this.x=t-this.width}},{key:"top",get:function(){return this.y},set:function(t){this.y=t}},{key:"center",get:function(){return new t(this.x+this.width/2,this.y+this.height/2)}}])&&n(e.prototype,u),l}(t);function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,r){return!r||"object"!==h(r)&&"function"!=typeof r?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function l(t,r){return(l=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}var h=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};var y={room:Symbol("room"),corridor:Symbol("corridor"),connector:Symbol("connector")},p={top:Symbol("top"),right:Symbol("right"),bottom:Symbol("bottom"),left:Symbol("left")},d=function(t){!function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&l(t,r)}(o,t);var r,e,n=(r=o,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=f(r);if(e){var o=f(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return s(this,t)});function o(t,r){var e,i=r.x,c=void 0===i?0:i,u=r.y,a=void 0===u?0:u,f=r.width,s=void 0===f?1:f,l=r.height,h=void 0===l?1:l,y=r.parent;return function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,o),(e=n.call(this,c,a,s,h)).type=t,e.parent=y,e.children=[],e}return o.isRoom=function(t){return t.type===y.room},o.isCorridor=function(t){return t.type===y.corridor},o.isConnector=function(t){return t.type===y.connector},o}(a);function g(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function b(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function x(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(t){if("string"==typeof t)return g(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?g(t,r):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var w=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m(this,t),this.setOptions(r),this.generate()}var r,n,o=t.prototype;return o.setOptions=function(r){if(!this.isValidOptions(r))throw Error('First argument "options" is invalid: every option must be a positive integer (excluding "seed")');this._options=function(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{},n=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(e).filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})))),n.forEach((function(r){v(t,r,e[r])}))}return t}({},t.getDefaultOptions(),this._options,r)},o.isValidOptions=function(r){var e=t.getDefaultOptions(),n=t.optionsValidators,o=!0;return Object.keys(e).forEach((function(t){var i=e[t],c=n[t],u=(r||{})[t];c(void 0===u?i:u)||(o=!1)})),o},o.forEachTile=function(t){for(var r=this.width,e=this.height,n=0;n<r;n++)for(var o=0;o<e;o++)t(n,o,this.isFloor(n,o));return this},o.isWall=function(t,r){return!this.isFloor(t,r)},o.isFloor=function(t,r){var e=!1;return t<=this.width&&r<=this.height&&(e=Boolean(this._buffer&&this._buffer.get(t,r))),e},o.generate=function(){this._rng=function(t){if(!Number.isFinite(t))throw Error('First argument "seed" must be a finite number.');var r=t;return function(){var t=(9301*r+49297)%233280;return r=t,t/233280}}(this._options.seed),this._builds=S(this._generateBuilds(this._options)),this._buffer=this._createBuffer(this._builds)},o._generateBuilds=function(t){var r=this._options.roomsAmount,e=[this._createRoom({x:0,y:0})];if(r>1)for(;e.filter(d.isRoom).length<r;){var n;(n=e).push.apply(n,x(this._tryBuild(e,t)))}return e},o._tryBuild=function(t,r){var e=t.filter((function(t){return!d.isCorridor(t)})),n=e[this._getRandom(0,e.length-1)],o=this._createBranch(n,r.corridorComplexity),i=t.concat(o);return o.some((function(t){return!O(t,i)}))&&(n.children.pop(),o=[]),o},o._createBranch=function(t){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=[],n=t,o=0;o<r;o++){var i=this._createCorridor({parentBuild:n}),c=null;c=o<r-1?this._createConnector({parentBuild:i}):this._createRoom({parentBuild:i}),e.push(i,c),n=c}return e},o._createRoom=function(t){var r=t.x,e=t.y,n=t.width,o=t.height,i=t.parentBuild,c=this._options,u=c.roomMinSize,a=c.roomMaxSize,f=this._createBuild(y.room,{parentBuild:i,x:r,y:e,width:n||this._getRandom(u,a),height:o||this._getRandom(u,a)});return i&&this._placeBuild(f,i),f},o._createCorridor=function(t){var r=t.parentBuild,e=this._options,n=e.corridorMinLength,o=e.corridorMaxLength,i=this._getRandom(n,o),c=this._createBuild(y.corridor,{parentBuild:r,width:1,height:1}),u=Object.values(p);return c.direction=u[this._getRandom(0,u.length-1)],r&&(_(c.direction)?c.width=i:c.height=i,this._placeBuild(c,r)),c},o._createConnector=function(t){var r=t.parentBuild,e=this._createBuild(y.connector,{width:1,height:1,parentBuild:r});return parent&&this._placeBuild(e,r),e},o._createBuild=function(t,r){var e=r.x,n=r.y,o=r.width,i=r.height,c=r.parentBuild,u=new d(t,{x:e,y:n,width:o,height:i,parent:c});return c&&(u.parent=c,c.children.push(u),u.direction=c.direction),u},o._placeBuild=function(t,r){var e=(t.type===y.corridor?t.direction:r.direction)||p.left;switch(_(e)?t.y=this._getRandom(r.top-t.height+1,r.bottom-1):t.x=this._getRandom(r.left-t.width+1,r.right-1),e){case p.left:t.x=r.right;break;case p.bottom:t.y=r.bottom;break;case p.right:t.x=r.left-t.width;break;case p.top:t.y=r.top-t.height}},o._getRandom=function(t,r){var e=this._rng();return Math.floor(t+e*(r+1-t))},o._createBuffer=function(t){var r=E(t),n=new e(r.x+1,r.y+1,0);return t.forEach((function(t){n.forEachInRect(t.x,t.y,t.width,t.height,(function(t,r){n.set(t,r,1)}))})),n},t.getDefaultOptions=function(){return{seed:Math.random(),roomsAmount:7,roomMinSize:5,roomMaxSize:10,corridorMinLength:3,corridorMaxLength:7,corridorComplexity:2}},r=t,(n=[{key:"width",get:function(){return this._buffer.width}},{key:"height",get:function(){return this._buffer.height}},{key:"rooms",get:function(){return this.builds.filter(d.isRoom)}},{key:"corridors",get:function(){return this.builds.filter(d.isCorridor)}},{key:"connectors",get:function(){return this.builds.filter(d.isConnector)}},{key:"builds",get:function(){return x(Array.isArray(this._builds)?this._builds:[])}}])&&b(r.prototype,n),t}();function _(t){return t===p.left||t===p.right}w.optionsValidators={seed:Number.isFinite,roomsAmount:C,roomMinSize:C,roomMaxSize:C,corridorMinLength:C,corridorMaxLength:C,corridorComplexity:C};var O=function(t,r){return!r.filter((function(r){var e=r===t,n=r===t.parent,o=t.children.includes(r),i=t.parent&&r.children.includes(t.parent)||r.parent&&t.children.includes(r.parent);return!(e||n||o||i)})).some((function(r){return r.collides(t)}))},S=function(t){var r=R(t);return M(t,r.x<1?1-r.x:0,r.y<1?1-r.y:0),t},M=function(t,r,e){t.forEach((function(t){t.x+=r,t.y+=e}))},R=function(r){var e=new t(1/0,1/0);return r.forEach((function(t){t.x<e.x&&(e.x=t.x),t.y<e.y&&(e.y=t.y)})),e},E=function(r){var e=new t(-1/0,-1/0);return r.forEach((function(t){t.right>e.x&&(e.x=t.right),t.bottom>e.y&&(e.y=t.bottom)})),e};function C(t){return"number"==typeof t&&Number.isInteger(t)&&t>0}var j=function(r,e,n,o){for(var i=new t(r,e),c=new t(n,o),u=c.x-i.x,a=c.y-i.y,f=Math.abs(u),s=Math.abs(a),l=u>0?1:-1,h=a>0?1:-1,y=new t(i.x,i.y),p=[y.clone()],d=0,g=0;d<f||g<s;)(.5+d)/f==(.5+g)/s?(y.x+=l,y.y+=h,d++,g++):(.5+d)/f<(.5+g)/s?(y.x+=l,d++):(y.y+=h,g++),p.push(y.clone());return p};function B(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t,r){return!r||"object"!==A(r)&&"function"!=typeof r?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function T(t,r){return(T=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}var A=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};var z=function(t){!function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&T(t,r)}(c,t);var r,e,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=P(n);if(o){var e=P(this).constructor;t=Reflect.construct(r,arguments,e)}else t=r.apply(this,arguments);return k(this,t)});function c(t){var r,e=t.x,n=t.y,o=t.g,u=t.h,a=t.parent;return function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,c),(r=i.call(this,e,n)).g=o||0,r.h=u||0,r.parent=a||null,r}return c.prototype.createPathToRoot=function(){for(var t=[],r=this;r.parent;)t.unshift(r),r=r.parent;return t},r=c,(e=[{key:"f",get:function(){return this.g+this.h}}])&&B(r.prototype,e),c}(t),I=function(t,r,e,n){return Math.abs(e-t)+Math.abs(n-r)},L=function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(e){for(var n=[],o=-1;o<=1;o++)for(var i=-1;i<=1;i++){var c=1!==Math.abs(i+o);!r&&c||t(e.x+i,e.y+o)&&n.push(new z({x:e.x+i,y:e.y+o,g:e.g+(c?Math.sqrt(2):1),parent:e}))}return n}};let F={x:0,y:0};function q(t,r){const e=document.querySelector(t);if(e){const t=e.querySelector("canvas"),n=e.querySelector(".js-reload-button");t&&(t.width=t.clientWidth,t.height=t.width/16*9,r(t)),n&&n.addEventListener("click",(()=>r(t)))}}function D(t,r){const e=t.getContext("2d"),{fov:n,path:o,dungeon:i}=r;r.tileSize=N(i,t),e.fillStyle="#f4f5f7",e.fillRect(0,0,t.width,t.height),i&&function(t,r){const{dungeon:e,roomColor:n="#82ccdd",corridorColor:o="#82ccdd",tileSize:i}=r;e.rooms.forEach((r=>{t.fillStyle=n,t.fillRect(r.x*i,r.y*i,r.width*i,r.height*i)})),e.corridors.concat(e.connectors).forEach((r=>{t.fillStyle=o,t.fillRect(r.x*i,r.y*i,r.width*i,r.height*i)}))}(e,r),n&&function(t,r){const{fov:e,center:n,radius:o,tileSize:i}=r;e.forEach((r=>{const e=1-Math.sqrt((n.x-r.x)**2+(n.y-r.y)**2)/o;t.fillStyle=`rgba(255,210,150,${e})`,t.globalAlpha=.7,t.fillRect(r.x*i,r.y*i,i,i),t.globalAlpha=1}))}(e,r),o&&function(t,{path:r,tileSize:e}){t.strokeStyle="#e74c3c",t.fillStyle="#e74c3c",t.lineWidth=Math.ceil(e/3),r.length&&(t.beginPath(),t.moveTo(r[0].x*e+e/2,r[0].y*e+e/2),r.forEach(((n,o)=>{0!==o&&o!==r.length-1||t.fillRect(n.x*e,n.y*e,e,e),t.lineTo(n.x*e+e/2,n.y*e+e/2)})),t.stroke(),t.closePath())}(e,r)}function N(t,r){const e=Math.min(r.width,r.height),n=Math.max(t.width,t.height);return Math.floor(e/n)||8}q(".js-section-dungeon",(t=>{D(t,{dungeon:new w({roomsAmount:12,roomMinSize:3,roomMaxSize:8,corridorMinLength:1,corridorMaxLength:4,corridorComplexity:3}),roomColor:"#3c6382",corridorColor:"#60a3bc"})})),q(".js-section-labyrinth",(t=>{D(t,{dungeon:new w({roomsAmount:64,roomMinSize:1,roomMaxSize:1,corridorMinLength:1,corridorMaxLength:1,corridorComplexity:1}),roomColor:"#4a69bd",corridorColor:"#4a69bd"})})),q(".js-section-explorer",(r=>{const e=new w({roomsAmount:3,roomMinSize:5,roomMaxSize:7,corridorMinLength:1,corridorMaxLength:1,corridorComplexity:1}),n=(o=(t,r)=>e.isFloor(t,r),function(r,e,n,i){if(!Number.isFinite(r+e+n))throw TypeError("First three arguments (centerX, centerY, radius) must be finite numbers");for(var c=new Set,u=[],a="function"==typeof i,f=Math.pow(n,2),s=new t(r,e),l=s.x-n,h=s.x+n,y=s.y-n,p=s.y+n,d=y;d<=p;d++)for(var g=l;g<=h;g++)if(l===g||h===g||y===d||p===d){var m=j(s.x,s.y,g,d),b=!0,v=!1,x=void 0;try{t:for(var w,_=m[Symbol.iterator]();!(b=(w=_.next()).done);b=!0){var O=w.value,S="".concat(O.x,"x").concat(O.y);if(!c.has(S)){if(!(Math.pow(s.x-O.x,2)+Math.pow(s.y-O.y,2)<=f&&o(O.x,O.y)))break t;u.push(O),a&&i(O.x,O.y),c.add(S)}}}catch(t){v=!0,x=t}finally{try{b||null==_.return||_.return()}finally{if(v)throw x}}}return u});var o;const i=N(e,r),c=n(parseInt(e.rooms[0].center.x),parseInt(e.rooms[0].center.y),12);r.onmousemove=t=>{F=function(t){const r={x:0,y:0};if(t instanceof Event){const e=t.target.getBoundingClientRect();r.x=t.clientX-e.left,r.y=t.clientY-e.top}return r}(t);const o={x:Math.floor(F.x/i),y:Math.floor(F.y/i)},c=n(o.x,o.y,12);e.isFloor(o.x,o.y)&&D(r,{fov:c,dungeon:e,radius:12,roomColor:"#1e272e",corridorColor:"#1e272e",center:o})},D(r,{fov:c,dungeon:e,radius:12,roomColor:"#1e272e",corridorColor:"#1e272e",center:e.rooms[0].center})})),q(".js-section-pathfinder",(r=>{const e=new w({roomsAmount:16,roomMinSize:4,roomMaxSize:12,corridorMinLength:1,corridorMaxLength:4,corridorComplexity:2});D(r,{path:function(r){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).getHeuristic,n=void 0===e?I:e;if("function"!=typeof r)throw new TypeError('First argument "isOpen" must be a function');var o=L(r);return function(r,e,i,c){var u=[],a=[],f=new z({x:r,y:e}),s=new z({x:i,y:c}),l=[];for(a.push(f);a.length>0;){var h=0,y=a[0];if(a.forEach((function(t,r){t.f<y.f&&(y=t,h=r)})),a.splice(h,1),u.push(y),t.isEqual(y,s)){l=y.createPathToRoot();break}var p=o(y),d=!0,g=!1,m=void 0;try{for(var b,v=function(r,e){var o=e.value,i=function(r){return t.isEqual(r,o)};if(u.some(i))return"continue";a.some(i)||(o.h=n(o.x,o.y,s.x,s.y),a.push(o))},x=p[Symbol.iterator]();!(d=(b=x.next()).done);d=!0)v(0,b)}catch(t){g=!0,m=t}finally{try{d||null==x.return||x.return()}finally{if(g)throw m}}}return l}}(((t,r)=>e.isFloor(t,r)))(parseInt(e.rooms[0].center.x),parseInt(e.rooms[0].center.y),parseInt(e.rooms[e.rooms.length-1].center.x),parseInt(e.rooms[e.rooms.length-1].center.y)),dungeon:e,roomColor:"#d4dae0",corridorColor:"#d4dae0"})}))})()})();